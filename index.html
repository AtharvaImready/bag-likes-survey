<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta charset="utf-8">
<title>Bag Preference Survey</title>
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
<style>
/* === GLOBAL STYLES === */
body, html {
    margin: 0;
    padding: 0;
    font-family: "Times New Roman", sans-serif;
    background-color: #fff2e6;
}
.header-section { padding: 20px 20px 40px 20px; text-align: center; }
.header-section h1 { margin: 0; }
.header-section p { font-size: 14px; color: #333; margin-top: 8px; }

/* === BAG DISPLAY === */
.bag-container { 
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 16px;
    overflow: hidden;
    max-width: 520px;
    margin-left: auto;
    margin-right: auto;
    padding: 10px;
}
h3 { margin-bottom: 8px; }
.swiper { width: 100%; height: 300px; }
.swiper-slide img { width: 100%; height: 100%; object-fit: contain; }
.controls { display: flex; align-items: center; padding-top: 10px; }
.like-btn { font-size: 20px; border: none; background: transparent; cursor: pointer; }
.like-btn.liked { color: #ff4d6d; font-weight: bold; }
.swiper-button-next, .swiper-button-prev {
    background-color: rgba(160, 160, 160, 0.8);
    color: white;
    width: 25px; height: 25px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
}
.swiper-button-next::after, .swiper-button-prev::after { font-size: 10px; font-weight: bold; }

/* === SURVEY FORM === */
.survey-questions {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    max-width: 520px;
    margin: 20px auto;
    padding: 25px;
}
.survey-question {
    font-weight: bold;
    margin-bottom: 20px;
    color: #333;
    padding-bottom: 15px;
    border-bottom: 1px solid #f0f0f0;
}
.survey-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 15px 0 25px;
}
.survey-option {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    background-color: #f9f9f9;
    border-radius: 6px;
    cursor: pointer;
}
.survey-option:hover { background-color: #f0f0f0; }
.survey-option input[type="radio"] {
    margin-right: 12px;
    accent-color: #ff4d6d;
}
.survey-submit-btn {
    background-color: #87CEFA;
    color: black;
    border: none;
    padding: 14px 24px;
    border-radius: 5px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
}
.survey-submit-btn:hover { background-color: #6CB4EE; }
</style>
</head>
<body>

<!-- HEADER -->
<div class="header-section">
    <h1>Bag Preference Survey</h1>
    <p>Please like the images of the bags you would consider buying, then answer the questions below.</p>
</div>

<!-- BAG DISPLAY -->
<div id="bags"></div>

<!-- SURVEY QUESTIONS -->
<div class="survey-questions">
    <div class="survey-question">
        <div>1. How often do you buy new bags?</div>
        <div class="survey-options">
            <label class="survey-option"><input type="radio" name="frequency" value="weekly"> Weekly</label>
            <label class="survey-option"><input type="radio" name="frequency" value="monthly"> Monthly</label>
            <label class="survey-option"><input type="radio" name="frequency" value="yearly"> Yearly</label>
            <label class="survey-option"><input type="radio" name="frequency" value="rarely"> Rarely</label>
        </div>
    </div>
    <div class="survey-question">
        <div>2. What's most important when choosing a bag?</div>
        <div class="survey-options">
            <label class="survey-option"><input type="radio" name="priority" value="price"> Price</label>
            <label class="survey-option"><input type="radio" name="priority" value="design"> Design</label>
            <label class="survey-option"><input type="radio" name="priority" value="brand"> Brand</label>
            <label class="survey-option"><input type="radio" name="priority" value="durability"> Durability</label>
        </div>
    </div>
    <div class="survey-question">
        <div>3. Price range you'd spend on a bag?</div>
        <div class="survey-options">
            <label class="survey-option"><input type="radio" name="price" value="under-1000"> Under ‚Çπ1,000</label>
            <label class="survey-option"><input type="radio" name="price" value="1000-2500"> ‚Çπ1,000 ‚Äì ‚Çπ2,500</label>
            <label class="survey-option"><input type="radio" name="price" value="2500-5000"> ‚Çπ2,500 ‚Äì ‚Çπ5,000</label>
            <label class="survey-option"><input type="radio" name="price" value="5000-10000"> ‚Çπ5,000 ‚Äì ‚Çπ10,000</label>
            <label class="survey-option"><input type="radio" name="price" value="above-10000"> Above ‚Çπ10,000</label>
        </div>
    </div>
    <div class="survey-question">
        <div>4. Below what price would you doubt the quality?</div>
        <div class="survey-options">
            <label class="survey-option"><input type="radio" name="low_price_doubt" value="500"> ‚Çπ500</label>
            <label class="survey-option"><input type="radio" name="low_price_doubt" value="750"> ‚Çπ750</label>
            <label class="survey-option"><input type="radio" name="low_price_doubt" value="1000"> ‚Çπ1,000</label>
            <label class="survey-option"><input type="radio" name="low_price_doubt" value="1250"> ‚Çπ1,250</label>
        </div>
    </div>
    <div class="survey-question">
        <div>5. Above what price is it too expensive?</div>
        <div class="survey-options">
            <label class="survey-option"><input type="radio" name="high_price_expensive" value="2000"> ‚Çπ2,000</label>
            <label class="survey-option"><input type="radio" name="high_price_expensive" value="2500"> ‚Çπ2,500</label>
            <label class="survey-option"><input type="radio" name="high_price_expensive" value="3000"> ‚Çπ3,000</label>
            <label class="survey-option"><input type="radio" name="high_price_expensive" value="3500"> ‚Çπ3,500</label>
        </div>
    </div>
    <div class="survey-question">
        <div>6. What is your age group?</div>
        <div class="survey-options">
            <label class="survey-option"><input type="radio" name="age" value="18-21"> 18‚Äì21 years</label>
            <label class="survey-option"><input type="radio" name="age" value="22-25"> 22‚Äì25 years</label>
            <label class="survey-option"><input type="radio" name="age" value="26-29"> 26‚Äì29 years</label>
            <label class="survey-option"><input type="radio" name="age" value="30-33"> 30‚Äì33 years</label>
        </div>
    </div>
    <div class="survey-question">
        <div>7. What city do you live in?</div>
        <input type="text" name="city" placeholder="Enter your city" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc;">
    </div>
    <button type="button" id="survey-submit-btn" class="survey-submit-btn">Submit</button>
</div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

<!-- Firebase + App Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, doc, updateDoc, increment, setDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyC3qRsJZMWW4pl8K2_VcpqMC1ImEtxAfhg",
    authDomain: "baglikesproject.firebaseapp.com",
    projectId: "baglikesproject",
    storageBucket: "baglikesproject.firebasestorage.app",
    messagingSenderId: "253305987836",
    appId: "1:253305987836:web:7dff95c1cd41165f48ed79"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Bag data & like state
const bagsData = [
    { id: "b00", images: ["images/b00.jpg", "images/b00_1.jpg", "images/b00_2.jpg"] },
    { id: "b01", images: ["images/b01.jpg", "images/b01_1.jpg", "images/b01_2.jpg"] },
    { id: "b02", images: ["images/b02.jpg", "images/b02_1.jpg", "images/b02_2.jpg"] },
    { id: "b03", images: ["images/b03.jpg"] },
    { id: "b04", images: ["images/b04.jpg"] }
];
const likesData = { b00: 0, b01: 0, b02: 0, b03: 0, b04: 0 };

function renderBags() {
    const container = document.getElementById('bags');
    container.innerHTML = '';
    bagsData.forEach((bag, index) => {
        const bagDiv = document.createElement('div');
        bagDiv.className = 'bag-container';
        bagDiv.innerHTML = `
            <h3>Bag ID: ${bag.id}</h3>
            <div class="swiper" id="swiper-${index}">
                <div class="swiper-wrapper">
                    ${bag.images.map(src => `<div class="swiper-slide"><img src="${src}"></div>`).join("")}
                </div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
            <div class="controls">
                <button class="like-btn" data-id="${bag.id}">ü§ç</button>
            </div>
        `;
        container.appendChild(bagDiv);

        new Swiper(`#swiper-${index}`, {
            loop: true,
            navigation: {
                nextEl: `#swiper-${index} .swiper-button-next`,
                prevEl: `#swiper-${index} .swiper-button-prev`,
            }
        });
    });

    document.querySelectorAll(".like-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            likesData[id] = likesData[id] === 1 ? 0 : 1;
            btn.classList.toggle('liked');
            btn.innerHTML = likesData[id] ? '‚ù§Ô∏è' : 'ü§ç';
        });
    });
}

async function incrementLikeInFirestore(bagId) {
    const bagRef = doc(db, "bag_likes", bagId);
    try {
        await updateDoc(bagRef, { like_count: increment(1) });
    } catch (error) {
        if (error.code === 'not-found' || error.message.includes('NOT_FOUND')) {
            await setDoc(bagRef, { like_count: 1 });
        }
    }
}

document.getElementById("survey-submit-btn").addEventListener("click", async () => {
    // Increment likes
    for (let bagId in likesData) {
        if (likesData[bagId] === 1) {
            await incrementLikeInFirestore(bagId);
        }
    }

    // Gather survey answers
    const surveyAnswers = {};
    document.querySelectorAll('.survey-questions input[type="radio"]:checked').forEach(input => {
        surveyAnswers[input.name] = input.value;
    });
    const cityInput = document.querySelector('input[name="city"]');
    if (cityInput) surveyAnswers.city = cityInput.value.trim();

    // Save survey answers to Firestore
    await addDoc(collection(db, "survey_responses"), {
        ...surveyAnswers,
        timestamp: serverTimestamp()
    });

    // Disable submit & notify
    const btn = document.getElementById("survey-submit-btn");
    btn.textContent = "Submitted";
    btn.disabled = true;
    localStorage.setItem("surveySubmitted", "true");
    alert("Thank you! Your responses have been recorded.");
});

window.addEventListener("load", () => {
    if (localStorage.getItem("surveySubmitted") === "true") {
        let btn = document.getElementById("survey-submit-btn");
        btn.textContent = "Submitted";
        btn.disabled = true;
    }
    renderBags();
});
</script>

</body>
</html>
